{{=<< >>=}}
<html>
<head>
<script>
draggedelement = null;
tid=0;
from_id=0;
to_id=0;
version=<<version>>;
function update(){
	var xmlHttp = new XMLHttpRequest();
	xmlHttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
	   newversion=parseInt(xmlHttp.responseText)
       console.log("old: "+ version+ ", new: " +newversion);
		if (newversion != version){
			location.reload(true);
}

    }
};

	xmlHttp.open( "GET", "/zap/update?version=4",true);
	
	xmlHttp.setRequestHeader("Content-Type", "text/plain;charset=UTF-8");
	xmlHttp.send(null);
	console.log(xmlHttp.responseType);

}
setInterval(update,1500);
function ol(){

	document.getElementById("teilnehmer_table").addEventListener("dragstart", function (e){
	//	console.log(e.clientY / e.clientHeight);
		console.log(e.offsetY/e.srcElement.clientHeight * e.srcElement.childElementCount);
		draggedelement2 = document.elementsFromPoint(e.pageX, e.pageY)[0].parentElement;
		tid = draggedelement2.children[0].innerHTML;
		from_id = draggedelement2.children[3].innerHTML;
		console.log(draggedelement2);
		draggedelement = document.createElement("tr");
		draggedelement.appendChild(draggedelement2.children[1].cloneNode(true));
		draggedelement.appendChild(draggedelement2.children[2].cloneNode(true));
		
		e.dataTransfer.setDragImage(draggedelement2,20,30);
	});
	i=0;
	for (element of document.getElementsByClassName("zelt_table")){
		element.addEventListener("dragover", function (e){
			console.log("over");
			e.preventDefault();
		});
		element.addEventListener("dragenter", function (e){
			console.log("enter");
			e.preventDefault();
			e.srcElement.style="border:2px solid lightgreen;";
			console.log(e.srcElement);
		});
		element.addEventListener("dragleave", function (e){
			console.log("leave");
			e.preventDefault();
			e.srcElement.style="border:2px solid darkcyan;";
			console.log(e.srcElement);
		});
		element.addEventListener("drop", function (e){
			var xmlHttp = new XMLHttpRequest();
			xmlHttp.open( "GET", "/zap/change_zelt?tid="+ tid +"&from="+ from_id +"&to="+ e.srcElement.getAttribute("name"), false);
			xmlHttp.send(null);
			e.srcElement.appendChild(document.getElementById("zt" + draggedelement2.children[0].innerHTML));	
			draggedelement2.children[3].innerHTML=e.srcElement.children[0].children[0].children[0].innerHTML.substring(6);
			console.log("drop");
			e.srcElement.style="border:2px solid darkcyan;";
		
			version++;	

		});
		i++;
	}
}
</script>
<style>

.teilnehmer_table {
  height: 90vh;
  width: 100%;
  table-layout: fixed;
}
.teilnehmer_table > tbody {
  display: block;
  width: 100%;
  overflow: auto;
  height:90vh;
}
.teilnehmer_table > thead > tr {
  display: block;
}
.teilnehmer_table > thead {
  background: black;
  color: #fff;
}
.teilnehmer_table th,
.teilnehmer_table td {
  padding: 5px;
  text-align: left;
}
.teilnehmer_row {
}
.teilnehmer_row:hover {
	background-color: darkcyan;
}
.zelt_table{
	vertical-align:top;
	border: 2px solid darkcyan;
	float:top;
	background-color:darkcyan;
	padding:5px;
	width:100% 
}
table {
	font-size: 30px;
}
</style>
</head>
<body onload="ol()">

<table style="height:95vh;float:center;margin:auto;width:95vw;background-color:blue">
	<tr>
	<td style="width:50%;background:darkred">
	<table class="teilnehmer_table">
<thead><tr>
	<th>id</th><th>name</th><th>nachname</th><th>zelt</th><th><input style="height:35px" /></th>
</tr></thead>	
	<tbody draggable=true id="teilnehmer_table" style="overflow:auto;background-color:darkgray;float:right;width:100%;float:top">
	<<#teilnehmer>>
	<tr class="teilnehmer_row">
	<td class="teilnehmer_row"><<& id>></td>
	<td class="teilnehmer_row"><<& vorname>></td>
	<td class="teilnehmer_row"><<& name>></td>
	<td class="teilnehmer_row"><<& zelt_id>></td>
	</tr>
	<</teilnehmer>>
	</table>
	</td>
	<td style="vertical-align:top;width:45%">

	<table style="width:45vw;height:95vh;overflow:auto;display:block;background-color:red;">
        <tbody>
	<<#zelte>>
		<tr><td style="width:50vw;">
		<table class="zelt_table" name="<<id>>" >
            <tbody>
            <tr>
			<th style="width:100%;background-color:#366;pointer-events:none;"colspan=2>Zelt #<<id>></th>
			</tr>
			<<#zteilnehmer>>
			<tr id="zt<<id>>">
			<td style="width:50%;pointer-events:none"><<& vorname>></td>
			<td style="width:50%;pointer-events:none"><<& name>></td>
			</tr>
			<</zteilnehmer>>
            </tbody></table>
		</tr></td>
	<</zelte>>
        </tbody>
	</table>


	</td>
	</tr>
</table>

</body>
</html>
